#include <WiFi.h>
#include <HTTPClient.h>
#include <DHT.h>

//Credenciales de la red wifi
#define NETWORK "Abcdefg"
#define PASSWORD "gatitosperritos123"
//Credenciales Scripts Google -> mirar si es la URL del Script
const char *scriptURL = "https://script.google.com/macros/s/AKfycbzdf3Looa0qmUbM7avcQbcgzGAXN5Y51EG7SeDkUi0KrqmiFpJaBlNsGPmoqZKu9jvH/exec";

//DHT
const uint8_t dhtPin = 14;
const uint8_t dhtType = 11;
DHT dht(dhtPin, dhtType);

//Variables de temperatura y humedad
float temperature;
float humidity;

void setup(){
  Serial.begin(115200);
  WiFi.begin(NETWORK, PASSWORD);
  while (WiFi.status()!=WL_CONNECTED){
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nConnected to WiFi");
  // dht.begin()
}

void loop(){
  if(readSensors()){
    sendToDataLogger();
  }
  delay(5000);
}

bool readSensors(){
  // temperature = dht.readTemperature();
  // humidity = dht.readHumidity();
  temperature = random(0,50);
  humidity = random(0,100);

  if (isnan(temperature)||isnan(humidity)){
    Serial.println("Failed to read from DDHT sensor :(");
    return false;
  }

  Serial.println("Temperature: " + String(temperature));
  Serial.println("Humidity: " + String(humidity));
  return true;
}

void sendToDataLogger(){
  if(WiFi.status() == WL_CONNECTED){
    HTTPClient http;
    http.begin(scriptURL);
    http.addHeader("Content-Type","application/json");
    String jsonData = String("{\"temperature\":") + temperature + ",\"humidity\":" + humidity + "}";
    int httpResponseCode = http.POST(jsonData);
    if(httpResponseCode > 0){
      String response = http.getString();
      Serial.println(httpResponseCode);
      Serial.println(response);
    }
    else Serial.println("Error in sending data");
    http.end();
  }
  else Serial.println("WiFi Disconnected");
}

